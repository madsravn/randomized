\documentclass[article,a4paper,oneside]{article}
%% Math stuffs
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[T1]{fontenc}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{todonotes}
\usepackage{hyperref}
\usepackage{graphicx}
\newtheorem{thm}{Theorem}
\newtheorem{definition}{Definition}
%%We have quite a bit of math inline, so let's remove the paragraph indent and instead move it a bit down
\parindent 0pt
\parskip 4mm
%% for easy Matrix notation
\newcommand{\+}[1]{\ensuremath{\boldsymbol{#1}}}

%%For syntaxhighligting when needed:
%%remember to invoke pdflatex with -shell-escape when not commented out
\usepackage{minted}

\begin{document}
\title{
Randomized Algorithms Project 2\\
A randomized fingerprinting algorithm for efficient computation of multiset equality.
}

\author{
  Mads Ravn - 20071580\\
  Bo Mortensen - 20073241\\
  Johan Abildskov - 20063623
}

\date{\today}

\maketitle

\newpage

\subsection*{Randomized fingerprinting of multisets}
\subsubsection*{Introduction}
In the following report we will describe the results from implementing a fingerprinting algorithm for determining multiset equality based upon $2$-$Universal$ hash functions and \emph{Schwartz-Zippel}.
The issue of determining multiset equality with a deterministic approach is that there are no obvious way that is better than using an efficient sorting algorithm and test for equality. Using the \emph{Schwartz-Zippel} approach also allows us to trivially extend the algorithm to a \emph{streaming} implementation, working efficiently on large datasets. No such approach seems to be possible for the deterministic approach.

\subsection*{Equality of hashed multisets}
\begin{definition}{2-Universal hash functions}\\
A hash function h(x) from some Universe \emph{U} to a table {T}, where $|U| >> |T|$, is 2\emph{-}universal iff $x \neq y, x,y \in U \Rightarrow Pr[h(x) = h(y)] \leq \frac{1}{|T|}$
\end{definition}
In the rest of the report $T$ will be $\mathbb{F}_p$ where $p = 2^{31} - 1$, which is prime.
We now consider two distinct multisets $X = \left[x_1,\cdots, x_n\right]$ and $Y = \left[y_1, \cdots, y_n\right]$. We note that we can assume that both sets have the same size, as it is trivial to determine inequality, if the multisets have different sizes.
We wish to show that using a given hash function $h$ selected uniformly randomly from the family of 2-universal hash functions $H$, $h(X) = \left[h(x_1),\cdots, h(x_n)\right]$ is equal to $h(Y) = \left[h(y_1),\cdots,h(y_n)\right]$ with at most probability $\frac{n}{p}$.
In order to do this consider the first element $x$ of $X$, the probability that $h(x) = h(y)$ is less than $\frac{1}{p}$ for any given $y \in Y$.
As there are $n$ elements in $Y$, the probability of a collision between $h(x)$ and an element in y is $\frac{n}{p}$, due to the 2-universality of $H$.
Now if we consider the second choice of $x$, one could argue that we would have $\frac{n-1}{p}$ different elements to hit in $Y$ with the collision of the next selected element $x \in X$,
but we are not able to make any claims as to the independence of these random choices. Thus we can't obtain a better bound on the probability that $h(X) = h(Y), X \neq Y$ than $n/p$.
\subsection*{A 2-universal family of hash functions}
\subsection*{Evaluating polynomials of hashed multisets}
We now consider the function $f_{H(X)}(z) = (z-h(x_1))(z-h(x_2))\ldots(z - h(x_n))$ and $f_{H(Y)}(z) = (z-h(y_1))(z-h(y_2))\ldots(z - h(y_n))$.
We wish to show that if we choose $z$ uniformly at random from $\mathbb{F}_p$ and $f_{H(X)}$ and $f_{H(Y))}$ are distinct polynomials, then the probability that we will discover this when evaluating $f_{H(X)}(z)$ and $f_{H(Y)}(z)$ is high. The strategy for showing this is showing that if the two polynomials are indeed distinct, then the polynomials will be evaluated to the same value with a probability lower than $\frac{n}{p}$.
To do this we construct a polynomial $g(z) = f_{H(X)}(z) - f_{H(X)}(z)$, it is clear that the two polynomials only evaluate to the same value if $g(z) = 0$. The degree of $g$ is $n$, which comes from the the $n$ $z$ terms in $g$.
As we select $z$ uniformly in $\mathbb{F}_p$, the polynomials will only evaluate to the same value with a probability less than $\frac{n}{|\mathbb{F}_p|} = \frac{n}{p}$. This bound stems from using the Schwartz-Zippel theorem on $g$.

\subsection*{A 2-universal family of hash functions}
As we would like to do the arithmetic modulo $p = 2^{31}-1$, we wish to create a family of hash functions that allows us to do work in $\mathbb{F}_p$, even though our elements are of size up to $2^{80}$.

We define $H_s=\{\ h_{a_1,\ldots,a_s}\ | \ a_1,\ldots,a)s\in \mathbb{F_p}\ \}$,
where $h_{a_,\ldots,a_s}(x_1,\ldots,x_s)$.

In order to show that \todo{Write this correctly}$H_s: 2^{80} \rightarrow 2^p$ indeed is 2-universal, we have to prove that the probability of a collision $h(x) = h(y)$ is less than $\frac{1}{p}$ if $x \neq y$.

Given two elements $x,y \in U, x \neq y$ and a hash function $h_s \in H_s$, the following holds:
\begin{align*}
h(x) &= h(y) \iff \\
\sum_{i=1}^{s}a_ix_i &= \sum_{i=1}^sa_iy_i \iff \\
\sum_{i=1}^{s}a_ix_i - \sum_{i=1}^sa_iy_i &= 0 \iff \\
a_1x_1 - a_1y_1 + \sum_{i=2}^{s}a_ix_i - \sum_{i=2}^sa_iy_i &= 0 \iff \\
\sum_{i=2}^{s}a_ix_i - \sum_{i=1}^sa_iy_i &= a_1(y_i-x_1) \iff \\
\frac{\sum_{i=2}^{s}a_ix_i - \sum_{i=1}^sa_iy_i}{y_1-x_1} &= a_1 \\
\end{align*}
As $x$ and $y$ are given, the only random choices in the above comes from the selection of the $a_i$s that fixes $h_s \in H_s$. We can now invoke the Principle of deferred decisions and assumme that all the other random entries in $a$ iare chosen before $a_1$. Then the left hand side of the above is fixed at some value $v \in \mathbb{F}_p$. Since $a_1$ is uniformly distributed over $\mathbb{F}_p$ the probability that $a_1 = v$ cannot exceed $\frac{1}{p}$. We have thus shown that $H_s$ as given is a 2 universal function of hash families.
\subsection*{A fingerprinting algorithm}
Our proposed algorithm trivially combines the previous sections in this report.
An input file can be considered as a multiset with its lines being the elements.
\end{document}
